<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="YouTube、TikTok、Instagramを埋め込んで再生できる動画プレイヤー">
    <title>YBM Ver.12.0</title>
    <style>
        /* ============================================
       CSS変数定義（グレースケール）
       ============================================ */
        :root {
            --color-primary: #333333;
            --color-primary-light: #555555;
            --color-secondary: #666666;
            --color-text: #1a1a1a;
            --color-text-muted: #666;
            --color-bg: #ffffff;
            --color-bg-secondary: #f8f8f8;
            --color-border: #e0e0e0;
            --color-error: #d32f2f;
            --color-success: #388e3c;
            --color-info: #1976d2;
            --color-accent: #999999;

            --spacing-md: 10px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            --transition-normal: 300ms ease-in-out;
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        /* ============================================
       基本スタイル
       ============================================ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            font-size: 1rem;
            color: var(--color-text);
            background-color: var(--color-bg);
            line-height: 1.6;
            transition: background-color var(--transition-normal), color var(--transition-normal);
        }

        .container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* ============================================
       ヘッダー
       ============================================ */
        header {
            background: linear-gradient(135deg, #333333 0%, #1a1a1a 100%);
            color: white;
            padding: var(--spacing-md) var(--spacing-lg);
            box-shadow: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
            flex: 1;
        }

        .youtube-logo {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .youtube-logo svg {
            width: 100%;
            height: 100%;
        }

        .header-text h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .header-text p {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        /* ============================================
       メインコンテンツ
       ============================================ */
        main {
            flex: 1;
            padding: var(--spacing-lg);
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        /* ============================================
       フォームセクション
       ============================================ */
        .form-section {
            background-color: var(--color-bg-secondary);
            padding: var(--spacing-xl);
            border-radius: 12px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            margin-bottom: var(--spacing-xl);
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: var(--spacing-lg);
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        .form-label {
            font-size: 1rem;
            font-weight: 500;
            color: var(--color-text);
        }

        input[type="text"],
        select {
            padding: var(--spacing-md);
            font-size: 1rem;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            background-color: var(--color-bg);
            color: var(--color-text);
            transition: border-color var(--transition-normal), box-shadow var(--transition-normal);
            font-family: inherit;
        }

        input[type="text"]:focus,
        select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(51, 51, 51, 0.1);
        }

        input[type="text"]::placeholder {
            color: var(--color-text-muted);
        }

        .form-hint {
            font-size: 0.875rem;
            color: var(--color-text-muted);
        }

        /* チェックボックスグループ */
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-lg);
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-size: 1rem;
            user-select: none;
        }

        .checkbox-label:hover {
            color: var(--color-primary);
        }

        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--color-primary);
        }

        /* ============================================
       ボタン
       ============================================ */
        button {
            padding: var(--spacing-md) var(--spacing-lg);
            font-size: 1rem;
            font-weight: 500;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all var(--transition-normal);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-family: inherit;
            min-height: 44px;
        }

        .btn-primary {
            background-color: var(--color-primary);
            color: white;
            box-shadow: var(--shadow-md);
            width: 100%;
        }

        .btn-primary:hover {
            background-color: var(--color-primary-light);
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background-color: var(--color-border);
            color: var(--color-text);
            padding: 8px var(--spacing-md);
            font-size: 0.875rem;
            min-height: 36px;
        }

        .btn-secondary:hover {
            background-color: var(--color-text);
            color: var(--color-bg);
        }

        .btn-loader {
            display: inline-block;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* ============================================
       メッセージエリア
       ============================================ */
        #messageArea {
            margin-bottom: var(--spacing-lg);
            padding: var(--spacing-md);
            border-radius: 8px;
            font-size: 1rem;
            min-height: 24px;
            display: none;
        }

        #messageArea.show {
            display: block;
        }

        #messageArea.error {
            background-color: rgba(211, 47, 47, 0.1);
            color: var(--color-error);
            border-left: 4px solid var(--color-error);
        }

        #messageArea.success {
            background-color: rgba(56, 142, 60, 0.1);
            color: var(--color-success);
            border-left: 4px solid var(--color-success);
        }

        #messageArea.info {
            background-color: rgba(25, 118, 210, 0.1);
            color: var(--color-info);
            border-left: 4px solid var(--color-info);
        }

        #messageArea.loading {
            color: var(--color-info);
            border-left: 4px solid var(--color-info);
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        /* ============================================
       動画セクション
       ============================================ */
        #videoTitle {
            font-size: 1.125rem;
            font-weight: 700;
            margin-bottom: var(--spacing-md);
            color: var(--color-text);
            word-break: break-word;
        }

        .video-section {
            margin-bottom: var(--spacing-xl);
        }

        #videoContainer {
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--color-bg-secondary);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-md);
            aspect-ratio: 16 / 9;
            max-width: 800px;
            margin: 0 auto;
        }

        #videoContainer.empty {
            display: none;
        }

        #videoContainer iframe {
            border: none;
            width: 100%;
            height: 100%;
        }

        /* サイズクラス */
        .small {
            max-width: 320px;
        }

        .medium {
            max-width: 640px;
        }

        .large {
            max-width: 960px;
        }

        .fullscreen {
            max-width: 100%;
        }

        /* ============================================
       履歴セクション
       ============================================ */
        .history-section {
            margin-top: var(--spacing-xl);
            padding-top: var(--spacing-xl);
            border-top: 1px solid var(--color-border);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            flex-wrap: wrap;
            gap: var(--spacing-md);
        }

        .history-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--color-text);
        }

        #historyList {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: var(--spacing-md);
            list-style: none;
        }

        .history-item {
            padding: var(--spacing-md);
            background-color: var(--color-bg-secondary);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            cursor: pointer;
            transition: all var(--transition-normal);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 8px;
            word-break: break-word;
        }

        .history-item:hover {
            background-color: var(--color-primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .history-item-text {
            flex: 1;
            font-size: 0.875rem;
            line-height: 1.4;
        }

        .history-item-delete {
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            padding: 4px;
            font-size: 18px;
            transition: opacity var(--transition-normal);
            flex-shrink: 0;
            min-height: auto;
        }

        .history-item-delete:hover {
            opacity: 0.7;
        }

        .history-empty {
            text-align: center;
            color: var(--color-text-muted);
            padding: var(--spacing-lg);
            font-size: 0.875rem;
            grid-column: 1 / -1;
        }

        /* ============================================
       フッター
       ============================================ */
        footer {
            background-color: var(--color-bg-secondary);
            border-top: 1px solid var(--color-border);
            padding: var(--spacing-lg);
            text-align: center;
            color: var(--color-text-muted);
            font-size: 0.875rem;
        }

        /* ============================================
       レスポンシブ対応
       ============================================ */
        @media (max-width: 768px) {
            header {
                padding: var(--spacing-md) var(--spacing-md);
                flex-direction: column;
                gap: var(--spacing-md);
                text-align: center;
            }

            .header-content {
                flex-direction: column;
                justify-content: center;
            }

            .header-text h1 {
                font-size: 1.5rem;
            }

            main {
                padding: var(--spacing-md);
            }

            .form-section {
                padding: var(--spacing-lg);
            }

            .checkbox-group {
                gap: var(--spacing-md);
            }

            #historyList {
                grid-template-columns: 1fr;
            }

            #videoContainer {
                max-width: 100%;
            }

            .small {
                max-width: 100%;
            }

            .medium {
                max-width: 100%;
            }

            .large {
                max-width: 100%;
            }
        }

        @media (max-width: 480px) {
            header {
                padding: var(--spacing-md) var(--spacing-md);
            }

            .youtube-logo {
                width: 32px;
                height: 32px;
            }

            .header-text h1 {
                font-size: 1.25rem;
            }

            .header-text p {
                font-size: 0.75rem;
            }

            main {
                padding: var(--spacing-md);
            }

            .form-section {
                padding: var(--spacing-lg);
            }

            input[type="text"],
            select {
                padding: 12px var(--spacing-md);
                font-size: 16px;
            }

            .btn-primary {
                min-height: 48px;
            }

            .checkbox-group {
                flex-direction: column;
                gap: var(--spacing-md);
            }

            .history-header {
                flex-direction: column;
                align-items: flex-start;
            }

            #clearHistoryBtn {
                width: 100%;
            }

            #videoContainer {
                max-width: 100%;
            }

            #videoTitle {
                font-size: 1rem;
            }

            .small {
                max-width: 100%;
            }

            .medium {
                max-width: 100%;
            }

            .large {
                max-width: 100%;
            }
        }

        @media (min-width: 1024px) {
            main {
                padding: var(--spacing-xl);
            }

            .form-section {
                max-width: 800px;
                margin-left: auto;
                margin-right: auto;
                margin-bottom: var(--spacing-xl);
            }

            #historyList {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- ヘッダー -->
        <header>
            <div class="header-content">
                <div class="youtube-logo">
                    <svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg">
                        <!-- YouTubeロゴ -->
                        <rect fill="white" x="2" y="4" width="20" height="16" rx="2.5" ry="2.5" />
                        <path fill="#1a1a1a" d="M10,15V9l5.5,3z" />
                    </svg>
                </div>
                <div class="header-text">
                    <h1>YBM Ver.12.0</h1>
                    <p>YouTube・TikTok・Instagramを簡単視聴</p>
                </div>
            </div>
        </header>

        <!-- メインコンテンツ -->
        <main>
            <!-- フォームセクション -->
            <section class="form-section">
                <form id="videoForm">
                    <!-- URL入力 -->
                    <div class="form-group">
                        <label for="videoUrl" class="form-label">動画URL</label>
                        <input id="videoUrl" type="text" placeholder="YouTube, TikTok, Instagram のURLを入力"
                            autocomplete="off">
                        <small class="form-hint">例: https://www.youtube.com/watch?v=xxxxx</small>
                    </div>

                    <!-- サイズ選択 -->
                    <div class="form-group">
                        <label for="sizeSelector" class="form-label">動画サイズ</label>
                        <select id="sizeSelector">
                            <option value="small">小サイズ (320×180)</option>
                            <option value="medium" selected>中サイズ (640×360)</option>
                            <option value="large">大サイズ (960×540)</option>
                            <option value="fullscreen">全画面</option>
                        </select>
                    </div>

                    <!-- チェックボックスオプション -->
                    <div class="form-group">
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="autoplay">
                                <span>自動再生</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="controls" checked>
                                <span>コントロール表示</span>
                            </label>
                        </div>
                    </div>

                    <!-- 送信ボタン -->
                    <button type="submit" class="btn-primary">
                        <span id="btnText">再生</span>
                        <span class="btn-loader" id="btnLoader" style="display: none;">...</span>
                    </button>
                </form>
            </section>

            <!-- メッセージエリア -->
            <div id="messageArea"></div>

            <!-- 動画タイトル -->
            <div id="videoTitle"></div>

            <!-- 動画コンテナ -->
            <section class="video-section">
                <div id="videoContainer" class="empty"></div>
            </section>

            <!-- 履歴セクション -->
            <section class="history-section">
                <div class="history-header">
                    <h2>最近見た動画</h2>
                    <button id="clearHistoryBtn" class="btn-secondary">履歴クリア</button>
                </div>
                <ul id="historyList"></ul>
            </section>
        </main>

        <!-- フッター -->
        <footer>
            <p>Copyright © 2026 Gr3nja All Rights Reserved.</p>
        </footer>
    </div>

    <script>
        /* ============================================
           ユーティリティ関数（メモリ効率重視）
           ============================================ */

        // メッセージ表示
        const MessageManager = {
            show(text, type = 'info', duration = 0) {
                const area = document.getElementById('messageArea');
                area.textContent = text;
                area.className = `show ${type}`;

                if (duration > 0) {
                    setTimeout(() => {
                        area.classList.remove('show');
                    }, duration);
                }
            },

            clear() {
                const area = document.getElementById('messageArea');
                area.classList.remove('show');
                area.textContent = '';
            }
        };

        // URL抽出関数
        const URLExtractor = {
            youtube(url) {
                const match = url.match(/(?:youtube\.com\/watch\?[^&]*v=|youtu\.be\/)([a-zA-Z0-9_-]+)/);
                return match ? match[1] : null;
            },

            tiktok(url) {
                const match = url.match(/tiktok\.com\/@[^\/]+\/video\/(\d+)/);
                return match ? match[1] : null;
            },

            instagram(url) {
                const match = url.match(/instagram\.com\/(reel|p|tv)\/([^\/?#]+)/);
                return match ? { type: match[1], id: match[2] } : null;
            }
        };

        // 埋め込みURL生成
        const EmbedGenerator = {
            generate(url, autoplay, controls) {
                const ytId = URLExtractor.youtube(url);
                if (ytId) {
                    let params = new URLSearchParams();
                    if (autoplay) params.append('autoplay', '1');
                    if (!controls) params.append('controls', '0');
                    return {
                        url: `https://www.youtube.com/embed/${ytId}${params.toString() ? '?' + params : ''}`,
                        type: 'youtube',
                        id: ytId
                    };
                }

                const tkId = URLExtractor.tiktok(url);
                if (tkId) {
                    return {
                        url: `https://www.tiktok.com/embed/v2/${tkId}`,
                        type: 'tiktok',
                        id: tkId
                    };
                }

                const igData = URLExtractor.instagram(url);
                if (igData) {
                    return {
                        url: `https://www.instagram.com/${igData.type}/${igData.id}/embed`,
                        type: 'instagram',
                        id: igData.id
                    };
                }

                return null;
            }
        };

        // 履歴管理
        const HistoryManager = {
            save(url, maxItems = 10) {
                try {
                    let history = JSON.parse(localStorage.getItem('videoHistory') || '[]');
                    history = history.filter(item => item !== url);
                    history.unshift(url);
                    if (history.length > maxItems) history = history.slice(0, maxItems);
                    localStorage.setItem('videoHistory', JSON.stringify(history));
                } catch (e) {
                    console.warn('Failed to save history:', e);
                }
            },

            get() {
                try {
                    return JSON.parse(localStorage.getItem('videoHistory') || '[]');
                } catch (e) {
                    return [];
                }
            },

            clear() {
                localStorage.removeItem('videoHistory');
            },

            remove(url) {
                let history = this.get();
                history = history.filter(item => item !== url);
                if (history.length > 0) {
                    localStorage.setItem('videoHistory', JSON.stringify(history));
                } else {
                    localStorage.removeItem('videoHistory');
                }
            }
        };

        // YouTubeタイトル取得
        const TitleFetcher = {
            async fetch(url) {
                try {
                    const response = await fetch(`https://noembed.com/embed?url=${encodeURIComponent(url)}`, {
                        signal: AbortSignal.timeout(5000)
                    });
                    if (!response.ok) throw new Error('API error');
                    const data = await response.json();
                    return data?.title || null;
                } catch (e) {
                    return null;
                }
            }
        };

        /* ============================================
           メインアプリケーション
           ============================================ */

        const VideoPlayer = {
            async init() {
                this.cacheElements();
                this.setupEventListeners();
                this.renderHistory();
            },

            cacheElements() {
                this.form = document.getElementById('videoForm');
                this.urlInput = document.getElementById('videoUrl');
                this.sizeSelector = document.getElementById('sizeSelector');
                this.autoplay = document.getElementById('autoplay');
                this.controls = document.getElementById('controls');
                this.container = document.getElementById('videoContainer');
                this.titleElem = document.getElementById('videoTitle');
                this.historyList = document.getElementById('historyList');
                this.clearBtn = document.getElementById('clearHistoryBtn');
                this.btnText = document.getElementById('btnText');
                this.btnLoader = document.getElementById('btnLoader');
            },

            setupEventListeners() {
                this.form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.embedVideo();
                });

                this.clearBtn.addEventListener('click', () => {
                    if (confirm('履歴をすべてクリアしますか？')) {
                        HistoryManager.clear();
                        this.renderHistory();
                        MessageManager.show('履歴がクリアされました', 'success', 2000);
                    }
                });

                this.sizeSelector.addEventListener('change', () => {
                    if (this.container.querySelector('iframe')) {
                        this.updateSize();
                    }
                });
            },

            async embedVideo() {
                const url = this.urlInput.value.trim();

                if (!url) {
                    MessageManager.show('URLを入力してください。', 'error', 3000);
                    this.urlInput.focus();
                    return;
                }

                if (!url.includes('.com') && !url.includes('.be')) {
                    MessageManager.show('有効なURLを入力してください。', 'error', 3000);
                    return;
                }

                this.setLoading(true);

                try {
                    const embedData = EmbedGenerator.generate(url, this.autoplay.checked, this.controls.checked);

                    if (!embedData) {
                        MessageManager.show('対応していないURLです。', 'error', 4000);
                        return;
                    }

                    const iframe = document.createElement('iframe');
                    iframe.src = embedData.url;
                    iframe.className = this.sizeSelector.value;
                    iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
                    iframe.allowFullscreen = true;
                    iframe.loading = 'lazy';

                    this.container.innerHTML = '';
                    this.container.classList.remove('empty');
                    this.container.appendChild(iframe);

                    MessageManager.show('動画が読み込まれました', 'success', 2000);

                    HistoryManager.save(url);
                    this.renderHistory();

                    if (embedData.type === 'youtube') {
                        const title = await TitleFetcher.fetch(url);
                        if (title) this.titleElem.textContent = title;
                    } else {
                        this.titleElem.textContent = `${embedData.type.toUpperCase()} 動画`;
                    }

                    setTimeout(() => {
                        this.container.scrollIntoView({ behavior: 'smooth' });
                    }, 100);

                } catch (e) {
                    console.error(e);
                    MessageManager.show('エラーが発生しました。', 'error', 4000);
                } finally {
                    this.setLoading(false);
                }
            },

            updateSize() {
                const iframe = this.container.querySelector('iframe');
                if (iframe) {
                    iframe.className = this.sizeSelector.value;
                }
            },

            setLoading(isLoading) {
                this.form.style.opacity = isLoading ? 0.6 : 1;
                this.form.style.pointerEvents = isLoading ? 'none' : 'auto';
                this.btnText.style.display = isLoading ? 'none' : 'inline';
                this.btnLoader.style.display = isLoading ? 'inline-block' : 'none';
                MessageManager[isLoading ? 'show' : 'clear'](isLoading ? '読み込み中...' : '', isLoading ? 'loading' : '');
            },

            renderHistory() {
                const history = HistoryManager.get();
                this.historyList.innerHTML = '';

                if (history.length === 0) {
                    const li = document.createElement('li');
                    li.className = 'history-empty';
                    li.textContent = '最近見た動画がありません';
                    this.historyList.appendChild(li);
                    return;
                }

                history.forEach((url) => {
                    const li = document.createElement('li');
                    li.className = 'history-item';

                    const text = document.createElement('span');
                    text.className = 'history-item-text';
                    text.textContent = url.length > 50 ? url.substring(0, 50) + '...' : url;
                    text.title = url;

                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'history-item-delete';
                    deleteBtn.innerHTML = '✕';
                    deleteBtn.type = 'button';
                    deleteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        HistoryManager.remove(url);
                        this.renderHistory();
                        MessageManager.show('削除されました', 'info', 1500);
                    });

                    li.appendChild(text);
                    li.appendChild(deleteBtn);
                    li.addEventListener('click', () => {
                        this.urlInput.value = url;
                        this.embedVideo();
                    });

                    this.historyList.appendChild(li);
                });
            }
        };

        // 起動
        document.addEventListener('DOMContentLoaded', () => VideoPlayer.init());
    </script>
</body>

</html>
